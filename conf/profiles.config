/*
 * Environment-specific resource profiles
 */

profiles {
    // Laptop/small system
    laptop {
        process {
            cpus   = { check_max( 2, 'cpus' ) }
            memory = { check_max( 8.GB, 'memory' ) }

            withLabel:process_gpu {
                cpus   = { check_max( 2, 'cpus' ) }
                memory = { check_max( 8.GB, 'memory' ) }
                accelerator = null  // Force CPU
            }
        }
        params {
            max_memory = '8.GB'
            max_cpus = 2
            force_cpu = true
        }
    }

    // Workstation
    workstation {
        process {
            withLabel:process_gpu {
                cpus   = { check_max( 8, 'cpus' ) }
                memory = { check_max( 32.GB, 'memory' ) }
                accelerator = [request: 1, type: 'nvidia']
            }
        }
        params {
            max_memory = '64.GB'
            max_cpus = 16
            num_gpus = 1
        }
    }

    // HPC cluster
    hpc {
        process {
            executor = 'slurm'

            withLabel:process_gpu {
                cpus   = { check_max( 16, 'cpus' ) }
                memory = { check_max( 128.GB, 'memory' ) }
                time   = { check_max( 24.h, 'time' ) }
                queue  = 'gpu'
                accelerator = [request: 4, type: 'nvidia']
                clusterOptions = '--gres=gpu:4 --constraint=gpu'
            }
        }
        params {
            max_memory = '512.GB'
            max_cpus = 64
            num_gpus = 4
        }
    }

    // Auto-detect system type
    auto {
        includeConfig { 
            def system_type = get_system_type()
            "profiles/${system_type}.config"
        }
    }
}

